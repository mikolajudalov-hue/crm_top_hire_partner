{% extends "layout.html" %}
{% block content %}
<style>
  .job-card {
    cursor: pointer;
    transition: all 0.15s ease-in-out;
  }
  .job-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 .5rem 1rem rgba(15, 23, 42, 0.15);
  }
  .job-short {
    overflow-wrap: anywhere;
    word-break: break-word;
  }
</style>

<div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-3">
  <div>
    <div class="small text-muted">–ü–∞—Ä—Ç–Ω—ë—Ä</div>
    <h1 class="hero-title mb-1">{{ g.user.name }}</h1>
  </div>
  <div>
    {% set tiers = ['Bronze','Silver','Gold','Platinum','Diamond'] %}
    {% set tier = g.user.note if g.user.note in tiers else 'Bronze' %}
    <div class="tier-badge tier-{{ tier|lower }}">{{ tier }}</div>
  </div>
</div>
{% if partner_note %}
<div class="alert alert-{{ 'danger' if '–Ω–µ –±—Ä–∞—Ç—å' in partner_note.lower() else 'success' }}">
  <strong>–ó–∞–º–µ—Ç–∫–∞ –ø–æ –∞–∫–∫–∞—É–Ω—Ç—É:</strong> {{ partner_note }}
</div>
{% endif %}
<div class="row g-3 mb-4">
  <div class="col-md-3"><div class="card p-4 kpi-card text-center">
    <div class="label small text-muted">–ú–æ–∏ –ø–æ–¥–∞—á–∏ (–º–µ—Å—è—Ü)</div>
    <div class="value display-6">{{ kpi.my_submissions }}</div>
  </div></div>
  <div class="col-md-3"><div class="card p-4 kpi-card text-center">
    <div class="label small text-muted">–ú–æ–∏ —Å—Ç–∞—Ä—Ç—ã (–º–µ—Å—è—Ü)</div>
    <div class="value display-6">{{ kpi.my_starts }}</div>
  </div></div>
  <div class="col-md-3"><div class="card p-4 kpi-card text-center">
    <div class="label small text-muted">–ú–æ–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫ (–º–µ—Å—è—Ü)</div>
    <div class="value h3 mb-0">{{ "%.2f"|format(kpi.my_partner_sum) }} PLN</div>
    <div class="small text-muted">–ù–∞—á–∏—Å–ª–µ–Ω–æ –ø–æ —Å—Ç–∞—Ä—Ç–∞–º</div>
  </div></div>
  <div class="col-md-3"><div class="card p-4 kpi-card text-center">
    <div class="label small text-muted">–ú–æ–π –±–∞–ª–∞–Ω—Å</div>
    <div class="value h3 mb-0">{{ "%.2f"|format(kpi.my_partner_balance) }} PLN</div>
    <div class="small text-muted">–£—á–∏—Ç—ã–≤–∞—è –≤—Å–µ –≤—ã–ø–ª–∞—Ç—ã</div>
  </div></div>
</div>
<h2 class="hero-title mb-3">–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏</h2>
<div class="row row-cols-1 row-cols-md-2 g-3">
  {% for job in jobs %}
  <div class="col">
    <div class="card h-100 p-3 position-relative job-card">
      <div class="d-flex justify-content-between align-items-start mb-1">
        <div>
          <h5 class="mb-1">{{ job.title }}</h5>
          <div class="small text-muted">{{ job.location }}</div>
          {% if job.short_description %}
          <div class="small mt-1 text-body-secondary">
            {{ job.short_description }}
          </div>
          {% endif %}
        </div>
        <div class="text-end">
          {% if job.priority == 'urgent' %}
            <span class="badge text-bg-danger mb-1">üî• –°—Ä–æ—á–Ω–æ</span><br>
          {% elif job.priority == 'low' %}
            <span class="badge text-bg-info mb-1">–ù–∏–∑–∫–∏–π</span><br>
          {% else %}
            <span class="badge text-bg-secondary mb-1">–û–±—ã—á–Ω–∞—è</span><br>
          {% endif %}
          {% if job.promo_multiplier and job.promo_multiplier > 1 %}
            <span class="badge text-bg-warning">‚ú® –ê–∫—Ü–∏—è x{{ job.promo_multiplier|round(2) }}</span>
          {% endif %}
        </div>
      </div>

      <p class="fw-semibold mb-1">–í–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–µ –ø–∞—Ä—Ç–Ω—ë—Ä—É:
        {% if job.promo_multiplier and job.promo_multiplier > 1 %}
          <span class="text-decoration-line-through text-muted small me-1">{{ job.partner_fee_amount }} PLN</span>
          <span>{{ (job.partner_fee_amount * job.promo_multiplier)|round(2) }} PLN</span>
        {% else %}
          <span>{{ job.partner_fee_amount }} PLN</span>
        {% endif %}
      </p>
      {% if job.promo_label %}
      <p class="mb-0 small text-warning-emphasis">üì¢ {{ job.promo_label }}</p>
      {% endif %}

      <div class="mt-2 d-flex justify-content-between align-items-center">
        <span class="small text-muted">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é</span>
        <span class="small text-muted">‚ûú</span>
      </div>

      <a href="{{ url_for('job_view', job_id=job.id) }}" class="stretched-link"></a>
    </div>
  </div>
  {% endfor %}
</div>
<hr class="my-4">
<h3>–ú–æ–∏ –ø–æ–¥–∞—á–∏</h3>
<form method="get" class="card p-3 mb-3">
  <div class="row g-3">
    <div class="col-md-4">
      <label class="form-label">–í–∞–∫–∞–Ω—Å–∏—è</label>
      <select class="form-select" name="job_id">
        <option value="">–í—Å–µ</option>
        {% for job in jobs %}
          <option value="{{ job.id }}" {% if current_filters.job_id==job.id %}selected{% endif %}>{{ job.title }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
      <select class="form-select" name="status">
        <option value="">–õ—é–±–æ–π</option>
        {% for st in pipeline %}
          <option value="{{ st }}" {% if current_filters.status==st %}selected{% endif %}>{{ st }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <label class="form-label">–ö–∞–Ω–¥–∏–¥–∞—Ç</label>
      <input type="text" class="form-control" name="q" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏" value="{{ current_filters.q or '' }}">
    </div>
  </div>
  <div class="mt-3">
    <button class="btn btn-primary me-2">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
    <a class="btn btn-outline-secondary" href="{{ url_for('index') }}">–°–±—Ä–æ—Å</a>
  </div>
</form>
<table class="table table-striped align-middle"><thead><tr><th>–î–∞—Ç–∞</th><th>–ö–∞–Ω–¥–∏–¥–∞—Ç</th><th>–í–∞–∫–∞–Ω—Å–∏—è</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
<tbody>
  {% for c, job_title in submissions %}
  <tr>
    <td>{{ c.created_at.date() }}</td>
    <td><a href="{{ url_for('candidate_view', cand_id=c.id) }}">{{ c.full_name }}</a></td>
    <td>{{ job_title or '–ù–µ –≤—ã–±—Ä–∞–Ω–∞' }}</td>
    <td>{{ c.status }}<br>
      <small class="text-muted">
        {% if c.status == '–ü–æ–¥–∞–Ω' %}–ö–∞–Ω–¥–∏–¥–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä—É{% elif c.status == '–í—ã—à–µ–ª –Ω–∞ —Ä–∞–±–æ—Ç—É' %}–ö–∞–Ω–¥–∏–¥–∞—Ç –≤—ã—à–µ–ª –≤ –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å{% elif c.status == '–ù–µ –≤—ã—à–µ–ª' %}–ö–∞–Ω–¥–∏–¥–∞—Ç –Ω–µ –ø—Ä–∏—à—ë–ª –≤ –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å{% elif c.status == '–û—Ç—Ä–∞–±–æ—Ç–∞–ª –º–µ—Å—è—Ü' %}–ö–∞–Ω–¥–∏–¥–∞—Ç –æ—Ç—Ä–∞–±–æ—Ç–∞–ª –º–µ—Å—è—Ü, –∫–æ–º–∏—Å—Å–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è{% elif c.status == '–ù–µ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª' %}–ö–∞–Ω–¥–∏–¥–∞—Ç –Ω–µ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª –º–µ—Å—è—Ü, –∫–æ–º–∏—Å—Å–∏—è –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è{% endif %}
      </small>
    </td>
  </tr>
  {% endfor %}
</tbody></table>
{% endblock %}